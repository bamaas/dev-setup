---

trigger:
  - main
  - mise-setup

jobs:
  - job:
    displayName: Install on MacOS
    pool:
      vmImage: macOS-latest
    steps:
      - script: make install
        displayName: install

  - job:
    displayName: Build Ubuntu image
    pool:
      vmImage: ubuntu-latest
    steps:
      - task: Docker@2
        displayName: Login to DockerHub
        inputs:
          command: login
          containerRegistry: dockerhub

      - script: make image/build
        displayName: Build image
        env:
          IMAGE_TAG: $(Build.SourceVersion)

      - script: make image/push
        displayName: Push image with latest tag
        env:
          IMAGE_TAG: $(Build.SourceVersion)
